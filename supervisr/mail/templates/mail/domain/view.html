{% extends "mail/base.html" %}

{% load supervisr_title %}
{% load i18n %}

{% block title %}
{% supervisr_title title %}
{% endblock %}

{% block content %}
<h1><clr-icon shape="world" size="48"></clr-icon>{{ domain.domain.domain }}</h1>
<div class="btn-group btn-link btn-icon-link">
</div>
<div class="row">
  <ul id="mailTabd" class="nav" role="tablist">
    <li role="presentation" class="nav-item">
      <button id="tabAccounts" class="btn btn-link nav-link" aria-controls="accounts"
      aria-selected="false" type="button">{% trans "Accounts" %}</button>
    </li>
    <li role="presentation" class="nav-item">
      <button id="tabAliases" class="btn btn-link nav-link" aria-controls="aliases"
      aria-selected="false" type="button">{% trans "Aliases" %}</button>
    </li>
    <li role="presentation" class="nav-item">
      <button id="tabDetails" class="btn btn-link nav-link" aria-controls="details"
      aria-selected="false" type="button">{% trans "Details" %}</button>
    </li>
    <li role="presentation" class="nav-item">
      <button id="tabGeneralSettings" class="btn btn-link nav-link" aria-controls="settingsGeneral"
      aria-selected="false" type="button">{% trans "General Settings" %}</button>
    </li>
    <li role="presentation" class="nav-item">
      <button id="tabSettingsSpam" class="btn btn-link nav-link" aria-controls="settingsSpam"
      aria-selected="false" type="button">{% trans "Spam Settings" %}</button>
    </li>
    <li role="presentation" class="nav-item">
      <button id="tabSettingsDKIM" class="btn btn-link nav-link" aria-controls="settingsDKIM"
      aria-selected="false" type="button">{% trans "DKIM Settings" %}</button>
    </li>
  </ul>
  <section id="accounts" role="tabpanel" aria-labelledby="tabAccounts" aria-hidden="true">
    <div class="btn-group btn-link btn-icon-link">
      <a href="{% url 'supervisr/mail:mail-account-new' %}" class="btn">
        <clr-icon shape="add"></clr-icon>
      </a>
      <a data-ctx-name="edit" class="btn">
        <clr-icon shape="edit"></clr-icon>
      </a>
      <a data-ctx-name="trash" class="btn">
        <clr-icon shape="trash"></clr-icon>
      </a>
      <div class="btn-group-overflow dropdown">
        <button class="btn dropdown-toggle" clrDropdown>
          <clr-icon shape="ellipsis-horizontal"></clr-icon>
        </button>
        <div class="dropdown-menu">
          <a data-ctx-name="setpassword" class="dropdown-item">{% trans 'Set Password' %}</a>
        </div>
      </div>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th>{% trans 'Full Address' %}</th>
          <th>{% trans 'Domain' %}</th>
          <th>{% trans 'Owner' %}</th>
          <th>{% trans 'Usage' %}</th>
          <th>{% trans 'Is Catchall?' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for account in acc_accounts %}
        <tr data-selectable data-ctx-edit="{% url 'supervisr/mail:mail-account-edit' account=account.address domain=account.domain.domain.domain %}?back={{ request.get_full_path }}" data-ctx-trash="{% url 'supervisr/mail:mail-account-delete' account=account.address domain=account.domain.domain.domain %}?back={{ request.get_full_path }}" data-ctx-setpassword="{% url 'supervisr/mail:mail-account-set-password' account=account.address domain=account.domain.domain.domain %}?back={{ request.get_full_path }}">
          <td>{{ account.address }}@{{ account.domain.domain.domain }}</td>
          <td>{{ account.domain.domain.domain }}</td>
          <td>{{ account.users.all|join:"," }}</td>
          <td>
            {% if account.quota > 0 %}
            <div class="progress labeled">
              <progress max="{{ account.quota }}" value="{{ account.size }}"></progress>
              <span></span>
            </div>
            {% else %}
            {{ account.size }}
            {% endif %}
          </td>
          <td>
            {% if account.is_catchall %}
            <clr-icon shape="check"></clr-icon>
            {% else %}
            <clr-icon shape="times"></clr-icon>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% include 'blocks/block_pagination.html' with pages=acc_accounts get_param='accountPage' %}
  </section>
  <section id="aliases" role="tabpanel" aria-labelledby="tabAliases" aria-hidden="true">
    <div class="btn-group btn-link btn-icon-link">
      <a href="{% url 'supervisr/mail:mail-alias-new' %}" class="btn">
        <clr-icon shape="add"></clr-icon>
      </a>
      <a data-ctx-name="edit" class="btn">
        <clr-icon shape="edit"></clr-icon>
      </a>
      <a data-ctx-name="trash" class="btn">
        <clr-icon shape="trash"></clr-icon>
      </a>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th>{% trans 'Address' %}</th>
          <th>{% trans 'Forwarder Destination' %}</th>
          <th>{% trans 'Owner' %}</th>
          <th>{% trans 'Is Catchall?' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for fwd in acc_aliases %}
        <tr data-selectable data-ctx-edit="{% url 'supervisr/mail:mail-alias-edit' domain=fwd.account.domain.domain.domain dest=fwd.destination %}?back={{ request.get_full_path }}" data-ctx-trash="{% url 'supervisr/mail:mail-alias-delete' domain=fwd.account.domain.domain.domain dest=fwd.destination %}?back={{ request.get_full_path }}">
          <td>{{ fwd.account.address }}@{{ fwd.account.domain.domain.domain }}</td>
          <td>{{ fwd.destination }}</td>
          <td>{{ fwd.account.users.all|join:"," }}</td>
          <td>
            {% if fwd.account.is_catchall %}
            <clr-icon shape="check"></clr-icon>
            {% else %}
            <clr-icon shape="times"></clr-icon>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% include 'blocks/block_pagination.html' with pages=acc_aliases get_param='aliasPage' %}
  </section>
  <section id="details" role="tabpanel" aria-labelledby="tabDetails" aria-hidden="true">
    <table class="table">
      <tbody>
        <tr>
          <td>{% trans "Created" %}</td>
          <td>{{ domain.created }}</td>
        </tr>
        <tr>
          <td>{% trans "Domain Provider" %}</td>
          <td>{{ domain.domain.provider.name }}</td>
        </tr>
      </tbody>
    </table>
  </section>
  <section id="settingsGeneral" role="tabpanel" aria-labelledby="tabGeneralSettings" aria-hidden="true">
  v
  </section>
  <section id="settingsSpam" role="tabpanel" aria-labelledby="tabSettingsSpam" aria-hidden="true">
  b
  </section>
  <section id="settingsDKIM" role="tabpanel" aria-labelledby="tabSettingsDKIM" aria-hidden="true">
  c
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
clrTabs();
clrTableSelect('section#accounts');
clrTableSelect('section#aliases');
</script>
{% endblock %}
